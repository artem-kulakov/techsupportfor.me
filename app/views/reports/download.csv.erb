<%-
  header = [
    'Project Name',
    'Task Name',
    'Staff Name',
    'Email',
    'Notes',
    'Time Spent',
    'Opened At',
    'Billable Status',
    'Ticket ID',
    'Status'
  ]

  rows = []

  @tickets.each do |ticket|
    rows << [
      ticket.labels.pluck(:name).join('|'),
      ticket.task == 'not_defined' ? '-' : t(ticket.task),
      ticket.assignee.try(:name),
      ticket.assignee.try(:email),
      ticket.replies.internal.last.nil? ? '' : '"' + truncate(strip_tags(ticket.replies.internal.last.content[/<div>.*?<\/div>/]), length: 100) + '"',
      ticket.time_spent,
      ticket.created_at.strftime("%m/%d/%Y"),
      ticket.billable == 'not_set' ? '-' : t(ticket.billable),
      ticket.id,
      t(ticket.status, scope: 'activerecord.attributes.ticket.statuses')
    ]
  end
-%>
<%= header.join(',') %>
<%- rows.each do |row| -%>
<%= row.join(',').html_safe %>
<%- end -%>
